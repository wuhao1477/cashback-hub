# 批量分享功能需求分析文档

> **文档版本**：v1.1  
> **创建日期**：2024-11-18  
> **更新日期**：2024-11-18  
> **状态**：需求分析阶段  
> **优先级**：P1（高优先级）

---

## 一、背景与问题

### 1.1 当前痛点

在实际使用场景中，用户需要将多个返利活动分享给他人（如微信好友、微信群、淘宝等），但现有系统存在以下问题：

1. **操作繁琐**：每个活动都需要单独点击、复制链接、粘贴发送，重复劳动严重
2. **效率低下**：当有 10+ 个活动需要分享时，操作时间成本极高
3. **易出错**：手动操作容易遗漏活动或重复发送
4. **体验割裂**：无法一次性展示多个优质活动，降低用户的分享意愿
5. **筛选困难**：活动数量众多时，难以快速定位符合特定条件的活动（如高返利官方活动、特定平台活动等）

### 1.2 用户需求

用户需要一个**批量分享功能**，能够：
- 快速选择多个活动
- **通过多维度筛选快速定位目标活动**（平台、服务商、返利范围等）
- 一键生成包含所有选中活动的分享文本
- 自定义分享内容的元素和格式
- 方便地复制到微信、淘宝等平台

---

## 二、解决方案概述

### 2.1 核心思路

通过生成**格式化长文本**的方式，将多个活动的关键信息（短链接、标题、返利比例等）整合在一起，用户只需一次复制、一次粘贴即可完成批量分享。

### 2.2 方案优势

- ✅ **零依赖**：纯文本方式，适用于任何聊天工具（微信、QQ、钉钉等）
- ✅ **简单高效**：一键生成、一键复制
- ✅ **精准筛选**：多维度筛选（平台、服务商、返利等），快速定位目标活动
- ✅ **灵活可控**：用户可自定义分享内容和格式
- ✅ **无需后端**：前端即可完成所有逻辑

---

## 三、功能需求详述

### 3.1 核心功能

#### 3.1.1 批量选择活动

**需求描述**：
- 在活动列表页面，支持多选模式
- 用户可以勾选想要分享的活动
- 提供"全选"、"反选"、"清空"等快捷操作

**交互方式**：
1. 进入批量选择模式（通过顶部按钮或长按活动卡片）
2. 活动卡片显示复选框
3. 点击卡片或复选框进行选择
4. 底部显示已选数量和操作按钮

**限制条件**：
- 最少选择 1 个活动
- 建议最多选择 50 个活动（避免文本过长）
- 仅支持选择"进行中"的活动（已过期活动不可选）

#### 3.1.2 活动筛选功能

**需求描述**：
在多选模式下，用户需要快速定位和筛选目标活动，避免在大量活动中逐个查找。通过多维度筛选功能，大幅提升批量选择的效率。

**筛选维度**：

| 筛选维度 | 说明 | 选项示例 | 优先级 |
|---------|------|---------|--------|
| 活动平台 | 按平台分类 | 美团、饿了么 | P0 |
| 服务商类型 | 按活动提供方分类 | 官方活动、折淘客服务商、第三方商家 | P1 |
| 返利范围 | 按返利金额/比例筛选 | 0-5元、5-10元、10-20元、20元以上 | P1 |
| 活动状态 | 按时间状态筛选 | 即将开始、进行中、即将结束（24h内） | P2 |
| 活动类型 | 按活动性质分类 | 新人专享、全场通用、指定品类、限时特惠 | P2 |
| 排序方式 | 调整显示顺序 | 返利从高到低、截止时间、热度排序 | P1 |

**服务商类型详细说明**：

1. **官方活动**
   - 美团官方：美团平台直营活动
   - 饿了么官方：饿了么平台直营活动
   - 识别方式：通过数据源标识或特定字段判断

2. **折淘客服务商**
   - 折淘客提供的第三方推广活动
   - 通常返利比例较高
   - 识别方式：API 数据中的 `promoter` 或 `source` 字段

3. **第三方商家**
   - 入驻商家发起的促销活动
   - 返利规则多样
   - 识别方式：商家标识字段

**交互方式**：

**方式一：顶部筛选栏（推荐）**
```
┌─────────────────────────────────────┐
│  ← 取消    批量分享 (3)    [筛选🔽] │
├─────────────────────────────────────┤
│  🔽 平台：全部  🔽 服务商：全部     │ <- 快速筛选
│  🔽 返利：全部  🔽 排序：默认       │
├─────────────────────────────────────┤
│  ☑️ 活动卡片 1                       │
│  ☐ 活动卡片 2                       │
```

**方式二：侧边抽屉**
```
用户点击顶部"筛选"按钮 → 从右侧滑出筛选面板
包含所有筛选条件和重置按钮
```

**筛选逻辑**：
- 多个维度之间为 **AND** 关系（交集）
- 同一维度多个选项为 **OR** 关系（并集）
- 实时筛选，无需"确认"按钮
- 显示当前筛选结果数量

**交互细节**：
1. **筛选标记**：已应用筛选时，显示小红点或数字徽章
2. **快速清除**：提供"清除所有筛选"按钮
3. **记忆功能**：记住用户最近使用的筛选条件
4. **空状态**：筛选无结果时，显示友好提示并建议调整条件

**筛选后的批量操作**：
- "全选"按钮仅选择**筛选结果**中的活动
- 已选中活动在切换筛选条件后仍保持选中状态
- 显示"已选 X / 筛选结果 Y / 总计 Z"

**示例场景**：

**场景1：筛选高返利的美团官方活动**
```
1. 进入批量分享模式
2. 筛选条件：平台=美团、服务商=官方活动、返利≥10元
3. 系统显示符合条件的 8 个活动
4. 用户全选这 8 个活动
5. 生成分享文本
```

**场景2：只分享饿了么的新人活动**
```
1. 进入批量分享模式
2. 筛选条件：平台=饿了么、活动类型=新人专享
3. 按返利从高到低排序
4. 选择前 5 个活动
5. 生成分享文本
```

#### 3.1.3 自定义分享内容

**需求描述**：
用户可以选择在生成的文本中包含哪些信息元素。

**可配置元素**：

| 元素 | 说明 | 默认状态 | 优先级 |
|------|------|---------|--------|
| 活动标题 | 活动的完整标题 | ✅ 必选 | P0 |
| 短链接 | H5/App/小程序链接 | ✅ 必选 | P0 |
| 返利比例 | 预估返利金额或比例 | ✅ 开启 | P0 |
| 活动截止时间 | 活动有效期 | ✅ 开启 | P1 |
| 平台标识 | 美团/饿了么标记 | ❌ 关闭 | P1 |
| 序号 | 活动编号（1、2、3...） | ✅ 开启 | P2 |
| 分隔线 | 活动之间的分隔符 | ✅ 开启 | P2 |
| 自定义前缀 | 用户自定义的开头文案 | ❌ 关闭 | P2 |
| 自定义后缀 | 用户自定义的结尾文案 | ❌ 关闭 | P2 |

**配置方式**：
- 提供"分享设置"对话框
- 使用开关（Switch）控制各元素的开启/关闭
- 配置项持久化到 localStorage

#### 3.1.4 生成分享文本

**需求描述**：
根据用户选择的活动和配置项，生成格式化的分享文本。

**文本格式示例**：

```text
🎁 精选返利活动推荐 🎁

1️⃣ 【美团】新人0元购外卖券
💰 返利：最高20元
⏰ 截止：2024-11-30
🔗 https://s.click.taobao.com/xxx

➖➖➖➖➖➖➖➖➖➖

2️⃣ 【饿了么】霸王餐免单活动
💰 返利：15%
⏰ 截止：2024-12-05
🔗 https://s.click.taobao.com/yyy

➖➖➖➖➖➖➖➖➖➖

3️⃣ 【美团】下午茶特惠
💰 返利：10元
⏰ 截止：2024-11-25
🔗 https://s.click.taobao.com/zzz

---
📢 更多优惠活动请关注...
```

**格式规范**：
- 使用 Emoji 提升视觉效果
- 每个活动之间用分隔线区分
- 链接放在最后一行，方便点击
- 支持纯文本格式（适配所有平台）

#### 3.1.5 一键复制功能

**需求描述**：
- 用户点击"复制"按钮，自动将生成的文本复制到剪贴板
- 复制成功后显示提示（Toast）
- 支持预览文本内容

**技术要点**：
- 使用 Clipboard API
- 降级方案：`document.execCommand('copy')`
- 处理复制失败的情况

### 3.2 辅助功能

#### 3.2.1 预览功能

**需求描述**：
- 在复制前，用户可以预览生成的文本
- 预览界面应当与实际分享效果一致
- 支持编辑预览内容（高级功能，可选）

#### 3.2.2 分享模板

**需求描述**（可选）：
- 提供多种预设分享模板
  - 简洁模式：仅标题+链接
  - 标准模式：标题+返利+链接
  - 详细模式：包含所有信息
- 用户可保存自定义模板

#### 3.2.3 链接类型选择

**需求描述**：
用户可选择生成哪种类型的链接：
- H5 短链接（适合微信分享）
- App 唤起链接（适合淘宝客）
- 小程序路径（适合微信小程序）

**默认策略**：
- 优先使用 H5 短链接
- 如果 H5 不可用，降级到 App 链接

---

## 四、用户场景与用例

### 4.1 场景一：微信群分享

**角色**：返利推广员  
**目标**：在微信群中分享今日最优惠的 5 个外卖活动  

**操作流程**：
1. 进入活动列表页
2. 点击"批量分享"按钮，进入多选模式
3. 勾选 5 个活动
4. 点击"生成分享文本"
5. 在配置中确认包含"返利比例"和"截止时间"
6. 预览文本内容
7. 点击"复制"按钮
8. 打开微信，粘贴发送到群聊

**预期结果**：
- 群友收到格式化的活动列表
- 可以直接点击链接参与活动

### 4.2 场景二：私聊精准推荐

**角色**：返利达人  
**目标**：根据好友需求，定制推荐 3 个高返利活动  

**操作流程**：
1. 进入活动列表，根据返利比例筛选
2. 选择 3 个高返利活动
3. 开启"返利比例"显示，关闭"平台标识"
4. 添加自定义前缀："根据你的需求，给你推荐以下活动 👇"
5. 生成并复制文本
6. 发送给好友

### 4.3 场景三：批量导出存档

**角色**：活动运营人员  
**目标**：导出本周所有活动的短链接，用于数据分析  

**操作流程**：
1. 全选当前页面的所有活动
2. 选择"简洁模式"（仅标题+链接）
3. 生成文本
4. 复制到 Excel 或文档中进行存档

### 4.4 场景四：精准筛选高返利官方活动

**角色**：返利推广员  
**目标**：向新用户推荐高返利的官方活动，提高转化率和信任度  

**操作流程**：
1. 进入活动列表页，点击"批量分享"
2. 点击"筛选"按钮，打开筛选面板
3. 设置筛选条件：
   - 平台：美团 + 饿了么（都选中）
   - 服务商：官方活动
   - 返利范围：10元以上
4. 排序：返利从高到低
5. 系统显示筛选结果：8个活动符合条件
6. 快速浏览并选择其中5个最合适的
7. 添加自定义前缀："🔥 官方活动，返利高达20元！"
8. 生成并复制文本
9. 发送给新用户

**预期结果**：
- 筛选效率：从50个活动中快速定位到8个高质量活动
- 选择准确：都是官方高返利活动，提升用户信任
- 转化提升：官方活动+高返利双重优势

---

## 五、技术方案概要

### 5.1 前端实现

#### 5.1.1 状态管理

使用 Pinia Store 管理批量分享的状态：

```typescript
interface BatchShareState {
  // 多选模式开关
  isMultiSelectMode: boolean;
  
  // 已选中的活动ID列表
  selectedActivityIds: Set<string>;
  
  // 筛选条件
  filterConditions: FilterConditions;
  
  // 分享配置
  shareConfig: ShareConfig;
  
  // 生成的文本
  generatedText: string;
}

interface FilterConditions {
  platforms: PlatformCode[];         // 选中的平台
  providerTypes: ProviderType[];     // 选中的服务商类型
  commissionRange?: CommissionRange; // 返利范围
  activityStatus?: ActivityStatus;   // 活动状态
  activityTypes: ActivityType[];     // 活动类型
  sortBy: SortOption;                // 排序方式
}

type ProviderType = 'official' | 'ztk' | 'thirdparty';
type CommissionRange = '0-5' | '5-10' | '10-20' | '20+';
type ActivityStatus = 'upcoming' | 'ongoing' | 'ending-soon';
type ActivityType = 'newcomer' | 'general' | 'category' | 'flash';
type SortOption = 'default' | 'commission-desc' | 'deadline-asc' | 'hot';

interface ShareConfig {
  includeTitle: boolean;        // 是否包含标题
  includeCommission: boolean;    // 是否包含返利
  includeDeadline: boolean;      // 是否包含截止时间
  includePlatform: boolean;      // 是否包含平台
  includeIndex: boolean;         // 是否包含序号
  includeDivider: boolean;       // 是否包含分隔线
  linkType: 'h5' | 'app' | 'mini'; // 链接类型
  customPrefix?: string;         // 自定义前缀
  customSuffix?: string;         // 自定义后缀
}
```

#### 5.1.2 文本生成逻辑

```typescript
function generateShareText(
  activities: ActivitySummary[],
  config: ShareConfig
): string {
  let text = config.customPrefix ? `${config.customPrefix}\n\n` : '';
  
  activities.forEach((activity, index) => {
    // 序号
    if (config.includeIndex) {
      text += `${index + 1}️⃣ `;
    }
    
    // 标题
    if (config.includeTitle) {
      text += `【${activity.platform}】${activity.title}\n`;
    }
    
    // 返利
    if (config.includeCommission) {
      text += `💰 返利：${activity.commissionText}\n`;
    }
    
    // 截止时间
    if (config.includeDeadline) {
      text += `⏰ 截止：${activity.deadlineText}\n`;
    }
    
    // 链接
    const link = getLink(activity, config.linkType);
    text += `🔗 ${link}\n`;
    
    // 分隔线
    if (config.includeDivider && index < activities.length - 1) {
      text += '\n➖➖➖➖➖➖➖➖➖➖\n\n';
    }
  });
  
  if (config.customSuffix) {
    text += `\n---\n${config.customSuffix}`;
  }
  
  return text;
}
```

#### 5.1.3 活动筛选逻辑

```typescript
// 识别服务商类型
function getProviderType(activity: ActivitySummary): ProviderType {
  // 根据数据源判断
  if (activity.source === 'official' || activity.isOfficial) {
    return 'official';
  }
  if (activity.source === 'ztk' || activity.promoter === 'zhetaoke') {
    return 'ztk';
  }
  return 'thirdparty';
}

// 获取返利金额（用于范围筛选）
function getCommissionAmount(activity: ActivitySummary): number {
  // 从 commissionText 中提取数字
  const match = activity.commissionText.match(/(\d+(?:\.\d+)?)/);
  return match ? parseFloat(match[1]) : 0;
}

// 判断活动状态
function getActivityStatus(activity: ActivitySummary): ActivityStatus {
  const now = Date.now();
  const deadline = new Date(activity.deadline).getTime();
  const timeLeft = deadline - now;
  
  if (now < activity.startTime) {
    return 'upcoming';
  }
  if (timeLeft <= 24 * 60 * 60 * 1000) {
    return 'ending-soon';
  }
  return 'ongoing';
}

// 筛选活动列表
function filterActivities(
  activities: ActivitySummary[],
  conditions: FilterConditions
): ActivitySummary[] {
  let filtered = [...activities];
  
  // 按平台筛选
  if (conditions.platforms.length > 0) {
    filtered = filtered.filter(activity => 
      conditions.platforms.includes(activity.platform)
    );
  }
  
  // 按服务商类型筛选
  if (conditions.providerTypes.length > 0) {
    filtered = filtered.filter(activity => 
      conditions.providerTypes.includes(getProviderType(activity))
    );
  }
  
  // 按返利范围筛选
  if (conditions.commissionRange) {
    const ranges: Record<CommissionRange, [number, number]> = {
      '0-5': [0, 5],
      '5-10': [5, 10],
      '10-20': [10, 20],
      '20+': [20, Infinity],
    };
    const [min, max] = ranges[conditions.commissionRange];
    filtered = filtered.filter(activity => {
      const amount = getCommissionAmount(activity);
      return amount >= min && amount < max;
    });
  }
  
  // 按活动状态筛选
  if (conditions.activityStatus) {
    filtered = filtered.filter(activity => 
      getActivityStatus(activity) === conditions.activityStatus
    );
  }
  
  // 按活动类型筛选
  if (conditions.activityTypes.length > 0) {
    filtered = filtered.filter(activity => 
      conditions.activityTypes.some(type => 
        activity.tags?.includes(type) || activity.type === type
      )
    );
  }
  
  // 排序
  switch (conditions.sortBy) {
    case 'commission-desc':
      filtered.sort((a, b) => 
        getCommissionAmount(b) - getCommissionAmount(a)
      );
      break;
    case 'deadline-asc':
      filtered.sort((a, b) => 
        new Date(a.deadline).getTime() - new Date(b.deadline).getTime()
      );
      break;
    case 'hot':
      // 假设有热度字段
      filtered.sort((a, b) => (b.hotScore || 0) - (a.hotScore || 0));
      break;
    default:
      // 保持默认顺序
      break;
  }
  
  return filtered;
}

// 在 Pinia Store 中使用
const batchShareStore = useBatchShareStore();

// 计算属性：获取筛选后的活动列表
const filteredActivities = computed(() => {
  return filterActivities(
    allActivities.value,
    batchShareStore.filterConditions
  );
});

// 计算属性：筛选统计
const filterStats = computed(() => ({
  total: allActivities.value.length,
  filtered: filteredActivities.value.length,
  selected: batchShareStore.selectedActivityIds.size,
}));
```

#### 5.1.4 复制到剪贴板

```typescript
async function copyToClipboard(text: string): Promise<boolean> {
  try {
    // 现代浏览器
    if (navigator.clipboard) {
      await navigator.clipboard.writeText(text);
      return true;
    }
    
    // 降级方案
    const textarea = document.createElement('textarea');
    textarea.value = text;
    textarea.style.position = 'fixed';
    textarea.style.opacity = '0';
    document.body.appendChild(textarea);
    textarea.select();
    const success = document.execCommand('copy');
    document.body.removeChild(textarea);
    return success;
  } catch (error) {
    console.error('复制失败:', error);
    return false;
  }
}
```

### 5.2 多端适配方案

#### 5.2.1 问题分析

批量分享功能需要同时适配 **PC端**、**H5移动端** 和 **平板端**，不同端的屏幕尺寸和交互方式差异较大：

| 终端类型 | 屏幕特点 | 交互方式 | 主要挑战 |
|---------|---------|---------|---------|
| PC端 | 大屏幕、横向布局 | 鼠标点击、键盘 | 空间充足，可并排显示更多信息 |
| H5移动端 | 小屏幕、竖向布局 | 触摸、手势 | 空间有限，需优化布局和操作流程 |
| 平板端 | 中等屏幕、双向布局 | 触摸为主 | 介于PC和移动端之间 |

**核心问题**：
1. 在活动列表页叠加多选模式，H5端屏幕空间不足
2. PC端有更多空间展示筛选条件和统计信息
3. 不同端的操作习惯差异（长按 vs 按钮点击）

#### 5.2.2 方案对比

**方案一：列表页内嵌模式**（原方案）

```
优点：
✅ 操作路径短，直接在列表页切换
✅ 开发成本低，复用现有列表组件
✅ 适合移动端的快速操作

缺点：
❌ H5端空间受限，筛选和统计信息展示困难
❌ PC端无法充分利用大屏空间
❌ 多选模式下列表滚动体验可能不佳
```

**方案二：独立页面模式**（推荐）

```
优点：
✅ 独立页面有更大的设计自由度
✅ 可针对不同端优化布局（PC三栏、H5单栏）
✅ 筛选面板、列表、预览可同屏显示（PC端）
✅ 避免影响原活动列表页的正常浏览
✅ 支持更复杂的批量操作（未来扩展）

缺点：
❌ 需要额外路由和页面
❌ 操作路径增加一步
❌ 需要处理页面间的数据传递
```

**方案三：Tab模式**

```
优点：
✅ 在活动列表页增加"批量分享"Tab
✅ 保持在同一页面上下文
✅ 适合频繁切换的场景

缺点：
❌ Tab数量增加（已有美团、饿了么）
❌ 与平台Tab概念混淆
❌ 仍然面临空间限制问题
```

#### 5.2.3 推荐方案：独立页面 + 响应式布局

**架构设计**：

```
/activities               # 活动列表页（现有）
/activities/batch-share   # 批量分享页（新增）
```

**页面布局**：

**PC端布局**（≥1024px）：
```
┌────────────────────────────────────────────────┐
│  Cashback Hub    批量分享    [返回活动列表]   │
├──────────┬─────────────────────┬───────────────┤
│          │                     │               │
│ 筛选面板 │    活动列表区域     │   预览/配置   │
│          │   (多选 + 统计)     │    区域       │
│ 平台     │                     │               │
│ 服务商   │  ☑️ 活动1           │  已选 5 个    │
│ 返利     │  ☐ 活动2           │               │
│ 状态     │  ☑️ 活动3           │  [预览文本]   │
│ 类型     │  ...                │               │
│          │                     │  [生成分享]   │
│ 排序     │  已选3/筛选12/总50  │               │
│          │                     │               │
│ [重置]   │  [全选] [反选]     │               │
│          │                     │               │
│ 200px    │      flex: 1        │    300px      │
└──────────┴─────────────────────┴───────────────┘
```

**H5移动端布局**（<768px）：
```
┌─────────────────────────────────┐
│  ← 批量分享          [筛选 ⚙️] │
├─────────────────────────────────┤
│  已选 3 / 筛选结果 12 / 总计 50 │ <- 吸顶统计
├─────────────────────────────────┤
│  [平台：美团 ×] [返利≥10元 ×]  │ <- 筛选标签
├─────────────────────────────────┤
│                                 │
│  ☑️ 【美团官方】新人0元购       │
│  💰 20元  ⏰ 11-30              │
│                                 │
│  ☐ 【美团官方】午餐特惠         │
│  💰 15元  ⏰ 12-05              │
│                                 │
│  ☑️ 【饿了么官方】下午茶        │
│  💰 12元  ⏰ 11-25              │
│                                 │
│  ...                            │
│                                 │
├─────────────────────────────────┤
│  [全选] [预览(3)] [生成分享]   │ <- 吸底操作栏
└─────────────────────────────────┘

点击"筛选" → 从底部弹出完整筛选面板
点击"预览" → 全屏预览对话框
```

**平板端布局**（768px-1023px）：
```
横屏时采用简化版PC布局（左右两栏）
竖屏时采用增强版H5布局
```

#### 5.2.4 入口设计

**方案A：活动列表页顶部按钮**（推荐）
```
活动列表页导航栏右侧添加"批量分享"按钮
点击后跳转到 /activities/batch-share
```

**方案B：活动列表页浮动按钮**
```
右下角固定浮动按钮，带徽章显示已选数量
点击后跳转到批量分享页
适合需要在浏览列表时持续添加活动的场景
```

**方案C：长按卡片触发**
```
长按活动卡片 → 自动跳转到批量分享页并选中该活动
适合移动端，符合原生应用习惯
```

#### 5.2.5 路由和状态管理

**路由配置**：
```typescript
{
  path: '/activities/batch-share',
  name: 'BatchShare',
  component: () => import('@/pages/BatchSharePage.vue'),
  meta: {
    title: '批量分享',
    keepAlive: true, // 保持页面状态
  }
}
```

**状态传递**：
```typescript
// 方式1：通过 query 参数传递预选活动ID
router.push({
  name: 'BatchShare',
  query: { preselect: 'id1,id2,id3' }
});

// 方式2：通过 Pinia Store 共享状态
const batchShareStore = useBatchShareStore();
batchShareStore.preselectActivities(['id1', 'id2', 'id3']);
router.push({ name: 'BatchShare' });

// 方式3：从活动列表页跳转时自动加载当前平台的活动
// 批量分享页会根据上一页的平台自动初始化
```

#### 5.2.6 响应式布局关键点

**使用 CSS Grid 和 Flexbox**：
```css
/* PC端三栏布局 */
@media (min-width: 1024px) {
  .batch-share-container {
    display: grid;
    grid-template-columns: 200px 1fr 300px;
    gap: 16px;
  }
}

/* 平板端两栏布局 */
@media (min-width: 768px) and (max-width: 1023px) {
  .batch-share-container {
    display: grid;
    grid-template-columns: 200px 1fr;
    gap: 16px;
  }
  .preview-panel {
    position: fixed; /* 预览用浮层 */
  }
}

/* H5端单栏布局 */
@media (max-width: 767px) {
  .batch-share-container {
    display: flex;
    flex-direction: column;
  }
}
```

**组件复用策略**：
```typescript
// 共用的核心组件
- ActivityCard.vue (支持多选模式)
- FilterPanel.vue (响应式筛选面板)
- SharePreview.vue (预览组件)
- ShareConfig.vue (配置组件)

// PC端特有
- SideFilterPanel.vue (侧边筛选)
- SidePreviewPanel.vue (侧边预览)

// H5端特有
- BottomActionBar.vue (底部操作栏)
- BottomFilterDrawer.vue (底部筛选抽屉)
```

#### 5.2.7 最终建议

**推荐采用：独立页面模式 + 响应式布局**

**理由**：
1. ✅ **用户体验最佳**：PC端可三栏布局，H5端优化单栏布局
2. ✅ **功能扩展性强**：未来可添加更多批量操作（批量编辑、批量删除等）
3. ✅ **性能更好**：独立页面避免影响列表页性能
4. ✅ **职责分离**：活动列表专注浏览，批量分享专注操作
5. ✅ **开发维护清晰**：独立路由、独立状态管理

**开发优先级**：
- Phase 1：实现H5单页面版本（满足移动端主场景）
- Phase 2：适配PC端三栏布局
- Phase 3：优化平板端体验

### 5.3 UI/UX 设计（列表页内嵌模式 - 参考）

> **注意**：以下设计为**方案一（列表页内嵌模式）**的UI方案。  
> 根据 5.2 多端适配分析，**推荐采用独立页面模式**。  
> 本节内容作为参考，或用于单端（仅H5）实现的备选方案。

#### 5.3.1 入口设计

**方案一：顶部固定按钮**
- 在活动列表页顶部导航栏添加"批量分享"按钮
- 点击后进入多选模式

**方案二：长按触发**（推荐）
- 长按活动卡片进入多选模式
- 自动选中长按的活动
- 更符合移动端操作习惯

**方案三：下拉菜单**
- 在顶部导航栏右侧添加"更多"菜单
- 菜单中包含"批量分享"选项

#### 5.3.2 多选模式界面

**布局变化**：
```
┌─────────────────────────────────┐
│  ← 取消    批量分享 (3)   全选  │ <- 顶部导航栏
├─────────────────────────────────┤
│  ☑️ 活动卡片 1                   │
│  ☐ 活动卡片 2                   │
│  ☑️ 活动卡片 3                   │
│  ...                            │
├─────────────────────────────────┤
│  [预览] [分享设置] [生成文本]   │ <- 底部操作栏
└─────────────────────────────────┘
```

**视觉反馈**：
- 选中的卡片高亮显示
- 复选框动画效果
- 底部操作栏吸底固定

#### 5.3.3 筛选界面

**顶部快速筛选栏**（推荐方案）：

```
┌─────────────────────────────────────────┐
│  ← 取消   批量分享 (3/15)   [筛选 ⚙️]  │
├─────────────────────────────────────────┤
│  🔽 平台：美团     🔽 服务商：官方      │ <- 快速筛选
│  🔽 返利：10元+    📊 排序：返利最高    │
├─────────────────────────────────────────┤
│  已选 3 / 筛选结果 15 / 总计 50         │ <- 统计信息
├─────────────────────────────────────────┤
│  ☑️ 【美团官方】新人0元购 返利20元      │
│  ☐  【美团官方】午餐特惠 返利15元       │
│  ☑️ 【美团官方】下午茶 返利12元         │
│  ...                                    │
└─────────────────────────────────────────┘
```

**完整筛选面板**（侧边抽屉）：

```
┌─────────────────────────────────────┐
│  筛选条件               [清除] [×] │
├─────────────────────────────────────┤
│  平台选择                           │
│  ☑️ 美团        ☑️ 饿了么          │
│                                     │
│  服务商类型                         │
│  ☑️ 官方活动    ☐  折淘客服务商    │
│  ☐  第三方商家                      │
│                                     │
│  返利范围                           │
│  ○  全部        ○  0-5元           │
│  ○  5-10元      ⦿  10-20元         │
│  ○  20元以上                        │
│                                     │
│  活动状态                           │
│  ⦿ 进行中       ○  即将开始        │
│  ○  即将结束（24h内）              │
│                                     │
│  活动类型                           │
│  ☑️ 新人专享    ☐  全场通用        │
│  ☐  指定品类    ☐  限时特惠        │
│                                     │
│  排序方式                           │
│  ○  默认排序    ⦿  返利从高到低    │
│  ○  截止时间    ○  热度排序        │
│                                     │
│  已应用 4 个筛选条件                │
│  [ 重置筛选 ]     [ 确定 ]         │
└─────────────────────────────────────┘
```

**交互细节**：

1. **筛选徽章**：顶部"筛选"按钮显示已应用的筛选条件数量
   ```
   [筛选 ⚙️ 4]  <- 表示应用了4个筛选条件
   ```

2. **快速筛选下拉**：点击快速筛选项，显示下拉菜单
   ```
   🔽 平台：全部 ▼
   ├─ ✓ 全部
   ├─ ✓ 美团
   └─ □ 饿了么
   ```

3. **筛选结果提示**：实时显示筛选结果数量
   - 有结果：显示"已选 X / 筛选结果 Y / 总计 Z"
   - 无结果：显示"暂无符合条件的活动，试试调整筛选条件"

4. **筛选标签**：在列表上方显示当前应用的筛选条件
   ```
   [美团 ×] [官方活动 ×] [返利≥10元 ×] [清除全部]
   ```

5. **空状态设计**：
   ```
   ┌─────────────────────────────────┐
   │         🔍                      │
   │    暂无符合条件的活动           │
   │                                 │
   │  当前筛选条件：                 │
   │  • 平台：美团                   │
   │  • 服务商：官方                 │
   │  • 返利：≥50元                  │
   │                                 │
   │  [ 调整筛选条件 ]               │
   └─────────────────────────────────┘
   ```

#### 5.3.4 配置界面

使用 van-action-sheet 或 van-dialog 展示配置选项：

```
┌─────────────────────────────────┐
│  分享设置               [×]     │
├─────────────────────────────────┤
│  基础信息                       │
│  ✅ 活动标题         [开]       │
│  ✅ 短链接           [开]       │
│  ✅ 返利比例         [开]       │
│  ✅ 截止时间         [开]       │
│  ☐  平台标识         [关]       │
│                                 │
│  格式设置                       │
│  ✅ 显示序号         [开]       │
│  ✅ 分隔线           [开]       │
│                                 │
│  链接类型                       │
│  ⦿ H5短链接  ○ App链接  ○ 小程序│
│                                 │
│  自定义文案（可选）             │
│  前缀：[输入框________________]│
│  后缀：[输入框________________]│
│                                 │
│  [ 恢复默认 ]     [ 保存配置 ] │
└─────────────────────────────────┘
```

#### 5.3.5 预览界面

```
┌─────────────────────────────────┐
│  预览                   [×]     │
├─────────────────────────────────┤
│  🎁 精选返利活动推荐 🎁        │
│                                 │
│  1️⃣ 【美团】新人0元购          │
│  💰 返利：最高20元              │
│  ⏰ 截止：2024-11-30            │
│  🔗 https://s.click.taobao...   │
│                                 │
│  ➖➖➖➖➖➖➖➖➖➖            │
│                                 │
│  2️⃣ 【饿了么】霸王餐           │
│  ...                            │
│                                 │
│  [编辑]      [复制]             │
└─────────────────────────────────┘
```

### 5.3 数据持久化

需要持久化的配置：

| 配置项 | 存储位置 | 说明 |
|--------|---------|------|
| 分享配置 | localStorage | 用户的个性化配置 |
| 自定义模板 | localStorage | 保存的模板 |
| 最近选择 | 内存 | 本次会话的选择记录 |

存储键名建议：
- `cashback-hub:share-config`
- `cashback-hub:share-templates`

---

## 六、非功能需求

### 6.1 性能要求

- 选择 50 个活动时，生成文本耗时 < 100ms
- 复制到剪贴板耗时 < 50ms
- 界面响应时间 < 16ms（60fps）

### 6.2 兼容性要求

- 支持 iOS Safari 12+
- 支持 Android Chrome 70+
- 支持微信内置浏览器
- 支持 iPad 横屏模式

### 6.3 可用性要求

- 多选模式下，误触率 < 5%
- 配置界面操作步骤 ≤ 3 步
- 文本格式在各平台显示一致性 > 95%

### 6.4 安全性要求

- 生成的链接不包含敏感信息
- 用户配置数据仅存储在本地
- 不上传用户选择记录到服务器

---

## 七、实现优先级与里程碑

### Phase 1：核心功能（MVP）
**目标**：实现基础的批量分享能力（H5独立页面）  
**时间**：1-2 周

- [ ] **新增批量分享页面**（/activities/batch-share）
- [ ] **页面路由和入口**（活动列表页顶部按钮）
- [ ] H5单栏响应式布局
- [ ] 多选模式UI
- [ ] 批量选择逻辑
- [ ] **基础筛选功能**（平台、排序）
- [ ] 基础文本生成（标题+链接）
- [ ] 一键复制功能
- [ ] 简单的配置项（返利、截止时间）

### Phase 2：配置与筛选增强
**目标**：支持自定义配置和高级筛选  
**时间**：1-1.5 周

- [ ] 完整的配置界面
- [ ] 配置持久化
- [ ] **完整筛选功能**（服务商类型、返利范围、活动状态、活动类型）
- [ ] **筛选条件持久化**
- [ ] 预览功能
- [ ] 链接类型选择
- [ ] **筛选统计显示**

### Phase 3：多端适配与体验优化
**目标**：PC端三栏布局 + 平板端适配  
**时间**：1-1.5 周

- [ ] **PC端三栏布局**（筛选面板 + 列表 + 预览）
- [ ] **平板端响应式适配**（横屏/竖屏）
- [ ] PC端侧边筛选面板组件
- [ ] PC端侧边预览面板组件
- [ ] 不同端的交互优化（鼠标悬停、键盘快捷键等）
- [ ] 分享模板功能
- [ ] 自定义前缀/后缀
- [ ] 统计功能（分享次数、热门活动）
- [ ] 分享记录

### Phase 4：高级功能（可选）
**目标**：差异化竞争力  
**时间**：待定

- [ ] 生成图片海报
- [ ] 二维码批量生成
- [ ] 导出为 Excel/CSV
- [ ] 定时发送提醒

---

## 八、风险与挑战

### 8.1 技术风险

| 风险 | 影响 | 概率 | 应对措施 |
|------|------|------|---------|
| 剪贴板API兼容性 | 高 | 中 | 提供降级方案 |
| 文本过长被截断 | 中 | 低 | 限制最大活动数量 |
| 链接失效 | 高 | 低 | 添加链接有效期检查 |
| 格式在不同平台错乱 | 中 | 中 | 使用通用文本格式 |

### 8.2 产品风险

| 风险 | 影响 | 概率 | 应对措施 |
|------|------|------|---------|
| 用户不理解如何使用 | 中 | 中 | 提供新手引导 |
| 生成的文本太长 | 低 | 高 | 提供字数统计和警告 |
| 配置项太复杂 | 中 | 低 | 提供默认推荐配置 |

---

## 九、测试要点

### 9.1 功能测试

- [ ] 单选、多选、全选、反选功能
- [ ] **筛选功能**
  - [ ] 按平台筛选
  - [ ] 按服务商类型筛选
  - [ ] 按返利范围筛选
  - [ ] 按活动状态筛选
  - [ ] 按活动类型筛选
  - [ ] 多条件组合筛选
  - [ ] 排序功能
- [ ] **筛选后全选**（仅选择筛选结果）
- [ ] **筛选条件清除**
- [ ] 不同配置组合的文本生成
- [ ] 复制到剪贴板功能
- [ ] 配置项持久化
- [ ] **筛选条件持久化**
- [ ] 链接类型切换
- [ ] 自定义文案显示

### 9.2 边界测试

- [ ] 筛选无结果的情况
- [ ] 筛选结果只有1个活动
- [ ] 同时应用所有筛选条件

- [ ] 0 个活动被选中
- [ ] 选中 100+ 个活动
- [ ] 活动标题包含特殊字符
- [ ] 网络断开时的表现
- [ ] localStorage 存储失败

### 9.3 兼容性测试

- [ ] iOS 微信内测试
- [ ] Android 微信内测试
- [ ] 淘宝 App 内测试
- [ ] 各主流浏览器测试

### 9.4 用户体验测试

- [ ] 首次使用的引导体验
- [ ] 操作流畅度
- [ ] 错误提示友好性
- [ ] 加载状态反馈

---

## 十、成功指标

### 10.1 功能指标

- 批量分享功能使用率 > 30%（相对于单个分享）
- 平均每次分享活动数 ≥ 3 个
- 复制成功率 > 99%
- **筛选功能使用率 > 60%**（在批量分享中使用筛选）
- **筛选后的活动选择准确率 > 80%**（用户筛选后的选择匹配度）

### 10.2 体验指标

- 功能满意度 ≥ 4.5/5.0
- 从选择到复制完成的平均时长 < 15 秒（使用筛选功能 < 20 秒）
- 用户主动配置分享格式的比例 > 20%
- **筛选条件平均使用数量 ≥ 2 个**
- **通过筛选减少浏览活动数量 > 50%**

### 10.3 业务指标

- 通过批量分享带来的活动点击率提升 > 50%
- 用户分享频次提升 > 30%
- 活动转化率提升 > 20%

---

## 十一、参考资料

### 11.1 竞品分析

- **淘宝客工具**：支持批量复制淘口令
- **拼多多助手**：支持批量生成推广链接
- **美团推广联盟**：提供批量导出功能

### 11.2 技术参考

- [Clipboard API - MDN](https://developer.mozilla.org/zh-CN/docs/Web/API/Clipboard_API)
- [Vue 3 Composition API](https://cn.vuejs.org/guide/extras/composition-api-faq.html)
- [Vant 4 - ActionSheet](https://vant-ui.github.io/vant/#/zh-CN/action-sheet)

---

## 十二、变更记录

| 版本 | 日期 | 修改人 | 变更内容 |
|------|------|--------|---------|
| v1.0 | 2024-11-18 | - | 初始版本，完成需求分析 |
| v1.1 | 2024-11-18 | - | 新增筛选功能需求（平台、服务商类型、返利范围等）<br>新增多端适配方案（推荐独立页面模式）<br>新增 PC/H5/平板三端响应式布局设计<br>更新实现优先级和测试计划 |

---

## 附录：术语表

- **批量分享**：一次性分享多个活动的功能
- **长文本**：包含多个活动信息的格式化文本
- **短链接**：经过缩短的活动推广链接
- **返利比例**：用户可获得的返利金额或百分比
- **多选模式**：允许用户同时选择多个项目的界面状态
